{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "width": 350,
  "height": 300,
  "title": {
    "text": "Transport Mode Distribution",
    "subtitle": "Percentage share by transport type (2023-24)",
    "fontSize": 18,
    "fontWeight": 600,
    "color": "#1e4d5c",
    "subtitleFontSize": 13,
    "subtitleColor": "#5a7d8a",
    "anchor": "start"
  },
  "data": {
    "url": "https://raw.githubusercontent.com/khoisday/Assignment-2/refs/heads/main/data/different-transport.csv",
    "format": { "type": "csv" }
  },
  "transform": [
    { "filter": "datum['Financial year'] == '2023-24'" },
    {
      "fold": ["Passenger cars", "Buses", "Rail", "Air", "Other "],
      "as": ["mode", "value"]
    },
    { "filter": "datum.value != null" },
    { "joinaggregate": [{ "op": "sum", "field": "value", "as": "total" }] },
    { "calculate": "datum.value / datum.total", "as": "percentage" },
    {
      "calculate": "datum.mode === 'Passenger cars' ? 1 : datum.mode === 'Rail' ? 2 : datum.mode === 'Air' ? 3 : datum.mode === 'Other ' ? 4 : 5",
      "as": "order"
    },
    {
      "window": [{ "op": "rank", "as": "rank" }],
      "sort": [{ "field": "order", "order": "ascending" }]
    },
    {
      "calculate": "format(datum.percentage, '.1%')",
      "as": "percentageText"
    },
    {
      "calculate": "datum.mode === 'Passenger cars' ? 'Car' : datum.mode",
      "as": "modeLabel"
    }
  ],
  "layer": [
    {
      "mark": { "type": "arc", "outerRadius": 140 },
      "encoding": {
        "order": { "field": "order", "type": "quantitative" },
        "theta": {
          "field": "value",
          "type": "quantitative",
          "stack": "normalize"
        },
        "color": {
          "field": "mode",
          "type": "nominal",
          "legend": null,
          "scale": {
            "domain": ["Passenger cars", "Buses", "Rail", "Air", "Other "],
            "range": ["#0f4c5c", "#9bc53d", "#489fb5", "#16697a", "#7a8c99"]
          }
        },
        "tooltip": [
          { "field": "mode", "type": "nominal", "title": "Transport Mode" },
          {
            "field": "value",
            "type": "quantitative",
            "title": "Distance Traveled (Billion km)",
            "format": ".1f"
          },
          {
            "field": "percentage",
            "type": "quantitative",
            "title": "Percentage",
            "format": ".1%"
          }
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "radius": 160,
        "fontSize": 12,
        "fontWeight": 600,
        "color": "#0f4c5c",
        "dy": -6
      },
      "encoding": {
        "order": { "field": "order", "type": "quantitative" },
        "theta": {
          "field": "value",
          "type": "quantitative",
          "stack": "normalize"
        },
        "text": {
          "field": "modeLabel",
          "type": "nominal"
        }
      }
    },
    {
      "mark": {
        "type": "text",
        "radius": 160,
        "fontSize": 12,
        "fontWeight": 600,
        "color": "#0f4c5c",
        "dy": 6
      },
      "encoding": {
        "order": { "field": "order", "type": "quantitative" },
        "theta": {
          "field": "value",
          "type": "quantitative",
          "stack": "normalize"
        },
        "text": {
          "field": "percentageText",
          "type": "nominal"
        }
      }
    }
  ],
  "config": {}
}
